#!/usr/bin/env bash -l
INVOKE_DIR=$(pwd)
MOAI_SDK_HOME=$(cd $(dirname "${0}")/../ && pwd)
MOAI_SDK_BIN=$(which moai)
MOAI_CMD=${1}

# if we're missing moai, inform the user that they need to build it first
if [ -z "$MOAI_SDK_BIN" ] 
then
    echo "Cannot find a local moai binary - you need to build it first."
    echo "Use the appropriate build-*.sh script located in $MOAI_SDK_HOME/bin"
    exit 1
fi

# add Moai util directory to path
export PATH ; PATH=$MOAI_SDK_HOME/util:$PATH

# call moaiutil.lua
shift
set $INVOKE_DIR $MOAI_SDK_HOME $MOAI_CMD $@

echo    "         MOAI SDK location: $MOAI_SDK_HOME"
echo    "      MOAI binary location: $MOAI_SDK_BIN"
echo -n "moaiutil toolbelt location: " && which moaiutil 
echo

pushd $MOAI_SDK_HOME/util > /dev/null
moai moaiutil.lua $@
popd > /dev/null
